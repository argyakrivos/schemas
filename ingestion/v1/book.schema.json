{
  "title": "Metadata about a book.",
  "type": "object",
  "properties": {
    "$schema": {
      "title": "The schema for this document.",
      "type": "string"
    },
    "classification": { "$ref": "common.schema.json#/definitions/classification" },
    // These are pieces of information we'd expect from an ONIX file
    "isbn": {
      "title": "The ISBN of the book. This field may not be useful if classifiers more general than ISBN are used.",
      "type": "string"
    },
    "title": {
      "title": "The title of the book",
      "type": "string"
    },
    "subtitle": {
      "title": "The subtitle of the book",
      "type": "string"
    },
    "contributors": {
      "title": "The array listing, in order, contributors this work is attributed to.",
      "type": "array",
      "items": {
        "$ref": "contributor.schema.json#/",
        "required": ["role"]
      }
    },
    "availability": {
      "title": "Details about the availability of this book item according to the publisher",
      "type": "object",
      "properties": {
        "notification_type": {
          "$ref": "#/definitions/availability"
        },
        "publishing_status": {
          "$ref": "#/definitions/availability"
        },
        "availability_code": {
          "$ref": "#/definitions/availability"
        },
        "product_availability":  {
          "$ref": "#/definitions/availability"
        },
        "blinkbox_books": {
          "title": "Custom availability code for manual undistributions.",
          "$ref": "#/definitions/availability"
        }
      }
    },
    "dates": {
      "title": "Information about dates relevant to the publishing of this book.",
      "type": "object",
      "properties": {
        "publish": {
          "title": "The date and time at which the publisher allows this book to go on sale.",
          "type": "string",
          "format": "date-time"
        },
        "announce": {
          "title": "The date and time at which the publisher allows this book to be announced - ie. have metadata released.",
          "type": "string",
          "format": "date-time"
        }
      },
      "additionalProperties": false
    },
    "descriptions": {
      "title": "The list of descriptions attached to a book. The first in the array is considered the most preferred.",
      "type": "array",
      "items": {
        "title": "A description of the associated book.",
        "type": "object",
        "properties": {
          "classification": { "$ref": "common.schema.json#/definitions/classification" },
          "content": {
            "title": "The content of the description.",
            "type": "string"
          },
          "source": {
            "title": "If the source of this element is different to that of the parent document (eg. with merged documents) then the details should be contained here.",
            "$ref": "common.schema.json#/definitions/source"
          }
        },
        "required": ["classification", "content"],
        "additionalProperties": false
      }
    },
    "language": {
      "title": "The languages (ISO-639/2B) the book is written in. Order is significant, with the 0 indexed language being the most promenant.",
      "type": "array",
      "items": {
        "$ref": "#/definitions/iso639-2b"
      }
    },
    "regional_rights": { "$ref": "common.schema.json#/definitions/regions" },
    "pages": {
      "title": "Number of pages in an equivalent physical book",
      "type": "integer"
    },
    "publisher": {
      "title": "The name of the publisher as it should appear on the site.",
      "type": "string"
    },
    "imprint": {
      "title": "The name of the publisher's imprint as it should appear on the site.",
      "type": "string"
    },
    "prices": {
      "title": "The array holding all publisher delivered prices for this book.",
      "type": "array",
      "items": {
        "title": "An individual price object detailing all aspects of a specific price for a book.",
        "type": "object",
        "properties": {
          "amount": {
            "title": "The amount associated with this price.",
            "type": "number"
          },
          "currency": {
            "title": "The ISO-4217 currency code associated with this price.",
            "$ref": "common.schema.json#/definitions/iso-4217"
          },
          "includes_tax?": {
            "title": "Whether this price includes tax or not.",
            "type": "boolean"
          },
          "agency?": {
            "title": "Whether this price is an agency model price or not.",
            "type": "boolean"
          },
          "discount_rate": {
            "title": "The discount rate which should be applied to this price (if no publisher level rate overrides it).",
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "valid_from": {
            "title": "The date time from which this price is valid.",
            "type": "string",
            "format": "date-time"
          },
          "applicable_regions": {
            "title": "The regions where this price can be used",
            "$ref": "common.schema.json#/definitions/regions"
          },
          "tax": {
            "title": "The list of taxes which need to be (includes_tax? = false), or have been (includes_tax? = true) applied to the amount. This is an array to be able to cope with banded taxing.",
            "type": "array",
            "items": {
              "rate": {
                "title": "The rate of tax. See ONIX 2.1 codelist 62 for details.",
                "enum": ["H","R","S","P","Z"]
              },
              "percent": {
                "type": "The percentage of the taxable_amount which should be considered the tax.",
                "type": "number",
                "minimum": 0,
                "maximum": 100
              },
              "amount": {
                "type": "The amount of money which the above percentage translates to (in the same currency).",
                "type": "number"
              },
              "taxable_amount": {
                "type": "The amount of money which is taxable at the specified rate.",
                "type": "number"
              }
            }
          }
        },
        "required": ["amount", "currency", "includes_tax?", "agency?"],
        "additionalProperties": false
      }
    },
    "subjects": {
      "title": "Categorisation of the book; keywords, genres etc.",
      "type": "array",
      "items": {
        "oneOf": [
          {
            "title": "BISAC codes",
            "type": "object",
            "properties": {
              "type": {
                "enum": ["BISAC"]
              },
              "code": {
                "title": "The BISAC code",
                // I could list an enum of valid BISAC codes, but that seems excessive
                "type": "string"
              }
            },
            "required": ["type", "code"],
            "additionalProperties": false
          },
          {
            "title": "BIC codes must be one of the accepted values",
            "type": "object",
            "properties": {
              "type": {
                "enum": ["BIC"]
              },
              "code": {
                "title": "The BIC code",
                // I could list an enum of valid BIC codes, but that seems excessive
                "type": "string"
              }
            },
            "required": ["type", "code"],
            "additionalProperties": false
          },
          {
            "title": "Anything that isn't BIC or BISAC codes we just take as informative",
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "pattern": "^(?!BI(?:SA)?C).*$"
              },
              "code": {
                "title": "The text used for this subject code",
                "type": "string"
              }
            },
            "required": ["type", "code"],
            "additionalProperties": false
          }
        ]
      }
    },
    "series": {
      "title": "Details about the series this book is in.",
      "type": "object",
      "properties": {
        "title": {
          "title": "The title of the series this book is in. This should be globally unique, but I have no clue how we can ensure that...",
          "type": "string"
        },
        "number": {
          "title": "This book's number in the series",
          "type": "integer",
          "minimum": 1
        }
      },
      "required": ["title"],
      "additionalProperties": false
    },
    // We'd expect media elements from an EPUB or COVER processor
    "media": {
      "anyOf": [
        { "$ref": "#/definitions/epub_media" },
        { "$ref": "common.schema.json#/definitions/image_media" }
      ]
    },
    "source": {
      "title": "The providence of the data contained within this object.",
      "$ref": "common.schema.json#/definitions/source"
    }
  },
  "required": ["classification", "source"],
  "additionalProperties": false,
  "definitions": {
    "epub_media": {
      "title": "This holds info about one or more epubs.",
      "type": "object",
      "properties": {
        "epubs": {
          "type": "array",
          "items": {
            "title": "The additional components of the media item which are specific to epubs.",
            "properties": {
              "$ref": "common.schema.json#/definitions/media_item",
              "keyfile": {
                "title": "The location of the (secured) keyfile for decrypting the ePub. This property should be present for books with 'drm:blinkboxbooks' in their classification.",
                "type": "string",
                "format": "uri"
              },
              "wordcount": {
                "title": "The number of words in the associated epub.",
                "type": "integer"
              }
            },
            "required": ["wordcount"]
            // Removed this because the $ref isn't being scanned for allowed properties.
            //"additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    },
    "availability": {
      "title": "An individual availability property",
      "type": "object",
      "properties": {
        "available": {
          "title": "Whether or not this book is available for sale by consequence of this availability metric",
          "type": "boolean"
        },
        "description": {
          "title": "A text description of why the 'available' setting is what it is. Used for informing the content manager.",
          "type": "string"
        }
      },
      "required": ["available"],
      "additionalProperties": false
    }
  }
}